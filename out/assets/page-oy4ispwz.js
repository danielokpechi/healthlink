import{r as h,d as p,v as xe,j as e,l as k,e as d,o as A,f as u,q as H,w as Q,T as J}from"./index-C6PY5QRv.js";import{H as pe,B as g,F as he}from"./Footer-BepvwvVu.js";import{C as x}from"./Card-D3mEm6qj.js";import{B}from"./Badge-B-7gq-4s.js";function fe(){const[y,U]=h.useState("overview"),[j,K]=h.useState({totalBloodBanks:0,approvedBanks:0,pendingBanks:0,rejectedBanks:0,activeDonors:0,totalRequests:0,completedDonations:0,totalRevenue:0,pendingApprovals:0}),[S,E]=h.useState([]),[$,z]=h.useState(!0),[V,W]=h.useState([]),[X,Y]=h.useState([]),[Z,ee]=h.useState([]),[te,T]=h.useState(!1),[v,F]=h.useState(null),[D,_]=h.useState(null),[I,R]=h.useState([]),[O,G]=h.useState(!0);async function se(t){try{const a=k(d,"users",t);await A(a,{userType:"superAdmin"}),R(o=>o.map(s=>s.id===t?{...s,userType:"superAdmin"}:s))}catch(a){console.error("Failed to make super admin",a)}}async function ae(t){try{const a=k(d,"users",t);await A(a,{userType:"donor"}),R(o=>o.map(s=>s.id===t?{...s,userType:"donor"}:s))}catch(a){console.error("Failed to remove super admin",a)}}const w=(t,a)=>{_(t),F(a),T(!0)},ne=async()=>{!D||!v||(T(!1),v==="approve"&&await ie(D),v==="reject"&&await de(D),_(null),F(null))},re=async()=>{z(!0);try{const t=p(d,"blood_banks"),o=(await u(t)).docs.map(s=>{const n=s.data();return{id:s.id,name:n.name||n.organizationName||n.title||"Unnamed",contactEmail:n.contactEmail||"",address:n.address||n.location||"",licenseNumber:n.licenseNumber||null,approved:!!n.approved,status:n.status||(n.approved?"approved":"pending"),createdAt:n.createdAt||null,updatedAt:n.updatedAt||n.approvedAt||null,raw:n}});E(o)}catch(t){console.error("Failed to load blood banks",t)}finally{z(!1)}},C=async()=>{try{const a=(await u(p(d,"blood_banks"))).docs.map(i=>i.data()),o=a.length,s=a.filter(i=>i.approved).length,n=a.filter(i=>i.status==="pending").length,r=a.filter(i=>i.status==="rejected").length,c=a.filter(i=>i.status==="pending").length,f=(await u(p(d,"users"))).docs.map(i=>i.data()).filter(i=>(i.userType||"").toLowerCase()==="donor").length,N=(await u(p(d,"requests"))).size,ce=(await u(p(d,"donations"))).docs.map(i=>i.data()).filter(i=>i.status==="completed").length,me=await u(p(d,"transactions"));let P=0;me.forEach(i=>{P+=i.data().amount||0}),K({totalBloodBanks:o,approvedBanks:s,pendingBanks:n,rejectedBanks:r,activeDonors:f,totalRequests:N,completedDonations:ce,totalRevenue:P,pendingApprovals:c})}catch(t){console.error("Failed to load global stats",t)}},q=async()=>{try{const t=await u(p(d,"requests")),a=await u(p(d,"donations")),o=await u(p(d,"blood_banks")),s=t.docs.map(m=>{const l=m.data();return{type:"request",timestamp:l.updatedAt||l.createdAt,action:`Requested ${l.bloodType||""}`,...l}}),n=a.docs.map(m=>{const l=m.data();return{type:"donation",timestamp:l.updatedAt||l.createdAt,action:`Donated ${l.bloodType||""}`,...l}}),r=o.docs.map(m=>{const l=m.data();return[l.updatedAt,l.approvedAt,l.rejectedAt].filter(Boolean).map(b=>b?.toDate?b.toDate():new Date(b)).sort((b,N)=>N.getTime()-b.getTime())[0]?l.status==="approved"?{type:"approval",timestamp:l.updatedAt||l.approvedAt,action:"Blood bank approved",name:l.name,...l}:l.status==="rejected"?{type:"rejection",timestamp:l.updatedAt||l.rejectedAt,action:"Blood bank rejected",name:l.name,...l}:null:null}).filter(Boolean),c=[...s,...n,...r].sort((m,l)=>{const f=m.timestamp?.toDate?m.timestamp.toDate().getTime():m.timestamp instanceof Date?m.timestamp.getTime():0;return(l.timestamp?.toDate?l.timestamp.toDate().getTime():l.timestamp instanceof Date?l.timestamp.getTime():0)-f}).slice(0,5);console.log("Recent activity combined:",c),W(c)}catch(t){console.error("Failed to load recent activity",t)}},L=async()=>{const t=await u(p(d,"blood_banks")),a=[];for(const s of t.docs){const n=s.id,r=s.data(),c=H(p(d,"transactions"),Q("bloodBankId","==",n)),m=await u(c);let l=0;m.forEach(M=>{l+=M.data().amount||0});const f=H(p(d,"donations"),Q("location","==",n)),N=(await u(f)).size;a.push({id:n,name:r.name,revenue:l,donations:N})}const o=a.sort((s,n)=>n.revenue-s.revenue).slice(0,5);Y(o)},le=async()=>{try{const t=await u(p(d,"blood_banks")),a={};t.forEach(n=>{const r=n.data();if(r.inventory)for(const c in r.inventory){const m=r.inventory[c];a[c]||(a[c]={total:0,critical:0}),a[c].total+=m.quantity,m.quantity<20&&(a[c].critical+=1)}});const o=Object.values(a).reduce((n,r)=>n+r.total,0),s=Object.keys(a).map(n=>{const r=a[n].total;return{type:n,total:r,critical:a[n].critical,percentage:o?Math.round(r/o*100):0}});ee(s)}catch(t){console.error("Failed to load inventory",t)}},oe=async()=>{G(!0);try{const s=(await u(p(d,"users"))).docs.map(n=>{const r=n.data(),c=r.userType||"donor";return{id:n.id,name:r.name||r.fullName||"Unnamed User",email:r.email||"",userType:c,phone:r.phone||"",createdAt:r.createdAt||null,lastActive:r.lastActive||r.updatedAt||null}}).filter(n=>["user","donor","superAdmin"].includes(n.userType)).sort((n,r)=>{const c=n.createdAt?.toDate?n.createdAt.toDate().getTime():0;return(r.createdAt?.toDate?r.createdAt.toDate().getTime():0)-c});R(s)}catch(t){console.error("Failed to load users",t)}finally{G(!1)}};h.useEffect(()=>{C(),re(),q(),L(),le(),oe()},[]),h.useEffect(()=>{const t=p(d,"blood_banks"),a=xe(t,o=>{const s=o.docs.map(n=>{const r=n.data();return{id:n.id,name:r.name||r.organizationName||r.title||"Unnamed",contactEmail:r.contactEmail||"",address:r.address||r.location||"",licenseNumber:r.licenseNumber||null,approved:!!r.approved,status:r.status||(r.approved?"approved":"pending"),createdAt:r.createdAt||null,updatedAt:r.updatedAt||r.approvedAt||null,raw:r}});E(s)});return()=>a()},[]);const ie=async t=>{try{const a=k(d,"blood_banks",t),o=J.now();await A(a,{approved:!0,approvedAt:o,status:"approved",updatedAt:o,rejectedAt:null}),await C(),await q(),await L()}catch(a){console.error("Approve failed",a)}},de=async t=>{try{const a=k(d,"blood_banks",t),o=J.now();await A(a,{approved:!1,rejectedAt:o,status:"rejected",updatedAt:o,approvedAt:null}),await C(),await q(),await L()}catch(a){console.error("Reject failed",a)}};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-white to-pink-50/30",children:[e.jsx(pe,{}),e.jsx("section",{className:"bg-gradient-to-r from-pink-500 via-purple-500 to-blue-500 text-white",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12",children:e.jsx("div",{className:"flex justify-between items-center mt-20",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold mb-2",children:"Super Admin Dashboard"}),e.jsx("p",{className:"text-pink-100 text-lg",children:"Global platform management and analytics"})]})})})}),e.jsx("section",{className:"bg-white border-b border-gray-200",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsx("div",{className:"flex space-x-8",children:[{id:"overview",label:"Overview",icon:"ri-dashboard-line"},{id:"bloodbanks",label:"Blood Banks",icon:"ri-hospital-line"},{id:"users",label:"Users",icon:"ri-user-line"}].map(t=>e.jsxs("button",{onClick:()=>U(t.id),className:`py-4 px-2 border-b-2 font-medium text-sm transition-colors duration-200 whitespace-nowrap ${y===t.id?"border-pink-500 text-pink-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx("i",{className:`${t.icon} mr-2`}),t.label]},t.id))})})}),e.jsx("section",{className:"py-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[y==="overview"&&e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(x,{className:"bg-gradient-to-r from-pink-500 to-rose-500 text-white border-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-pink-100 text-sm",children:"Approved Blood Banks"}),e.jsx("p",{className:"text-3xl font-bold",children:j.approvedBanks})]}),e.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-lg flex items-center justify-center",children:e.jsx("i",{className:"ri-hospital-line text-2xl"})})]})}),e.jsx(x,{className:"bg-gradient-to-r from-purple-500 to-pink-500 text-white border-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-purple-100 text-sm",children:"Active Donors"}),e.jsx("p",{className:"text-3xl font-bold",children:j.activeDonors.toLocaleString()})]}),e.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-lg flex items-center justify-center",children:e.jsx("i",{className:"ri-user-heart-line text-2xl"})})]})}),e.jsx(x,{className:"bg-gradient-to-r from-blue-500 to-purple-500 text-white border-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-100 text-sm",children:"Total Revenue"}),e.jsxs("p",{className:"text-3xl font-bold",children:["₦",j.totalRevenue.toLocaleString()]})]}),e.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-lg flex items-center justify-center",children:e.jsx("i",{className:"ri-money-dollar-circle-line text-2xl"})})]})}),e.jsx(x,{className:"bg-gradient-to-r from-green-500 to-blue-500 text-white border-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-green-100 text-sm",children:"Completed Donations"}),e.jsx("p",{className:"text-3xl font-bold",children:j.completedDonations.toLocaleString()})]}),e.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-lg flex items-center justify-center",children:e.jsx("i",{className:"ri-heart-pulse-line text-2xl"})})]})})]}),j.pendingApprovals>0&&e.jsx(x,{className:"border-l-4 border-l-yellow-500 bg-yellow-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("i",{className:"ri-alert-line text-yellow-500 text-xl mr-3"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Pending Blood Bank Approvals"}),e.jsxs("p",{className:"text-gray-600",children:[j.pendingApprovals," blood banks awaiting approval"]})]})]}),e.jsx(g,{onClick:()=>U("bloodbanks"),className:"bg-yellow-500 hover:bg-yellow-600 text-white",children:"Review Now"})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs(x,{children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-6",children:"Recent Activity"}),e.jsx("div",{className:"space-y-4",children:V.map((t,a)=>e.jsxs("div",{className:"flex items-center space-x-4 p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${t.type==="donation"?"bg-green-100":t.type==="request"?"bg-blue-100":t.type==="approval"?"bg-purple-100":t.type==="rejection"?"bg-red-100":"bg-gray-100"}`,children:e.jsx("i",{className:`${t.type==="donation"?"ri-heart-fill text-green-500":t.type==="request"?"ri-search-line text-blue-500":t.type==="approval"?"ri-check-line text-purple-500":t.type==="rejection"?"ri-close-line text-red-500":"ri-information-line text-gray-500"}`})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-900",children:t.user||t.name}),e.jsx("p",{className:"text-sm text-gray-600",children:t.type==="donation"?`Donated ${t.bloodType}`:t.type==="request"?`Requested ${t.bloodType}`:t.type==="approval"?"Blood bank approved":t.type==="rejection"?"Blood bank rejected":t.action||"Activity"})]})]},a))})]}),e.jsxs(x,{children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-6",children:"Top Performing Blood Banks"}),e.jsx("div",{className:"space-y-4",children:X.map((t,a)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-pink-500 rounded-full flex items-center justify-center text-white font-bold text-sm",children:a+1}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:t.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:[t.donations," donations"]})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:"font-semibold text-gray-900",children:["₦",t.revenue.toLocaleString()]})})]},a))})]})]})]}),y==="bloodbanks"&&e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6",children:[e.jsx(x,{className:"bg-gradient-to-r from-purple-500 to-pink-500 text-white border-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white text-sm",children:"Total Blood Banks"}),e.jsx("p",{className:"text-2xl font-bold",children:j.totalBloodBanks})]}),e.jsx("i",{className:"ri-hospital-line text-2xl text-white"})]})}),e.jsx(x,{className:"bg-gradient-to-r from-green-500 to-blue-500 text-white border-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white text-sm",children:"Approved"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:j.approvedBanks})]}),e.jsx("i",{className:"ri-check-line text-2xl text-white"})]})}),e.jsx(x,{className:"bg-gradient-to-r from-yellow-400 to-yellow-500 text-white border-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white text-sm",children:"Pending"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:j.pendingBanks})]}),e.jsx("i",{className:"ri-time-line text-2xl text-white"})]})}),e.jsx(x,{className:"bg-gradient-to-r from-pink-500 to-rose-500 text-white border-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white text-sm",children:"Rejected"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:j.rejectedBanks})]}),e.jsx("i",{className:"ri-close-line text-2xl text-white"})]})})]}),e.jsxs(x,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"Blood Banks"}),e.jsxs(B,{variant:"warning",children:[S.filter(t=>t.status==="pending").length," Pending"]})]}),e.jsxs("div",{className:"space-y-4",children:[$&&e.jsx("p",{className:"text-gray-600",children:"Loading blood banks..."}),!$&&(()=>{const t=S.filter(s=>s.status==="pending"),a=S.filter(s=>s.status!=="pending").sort((s,n)=>{const r=s.updatedAt?.toDate?s.updatedAt.toDate().getTime():0;return(n.updatedAt?.toDate?n.updatedAt.toDate().getTime():0)-r});return[...t,...a].map(s=>e.jsx(x,{className:`border-l-4 ${s.status==="pending"?"border-l-yellow-500":s.status==="approved"?"border-l-green-500":"border-l-red-500"}`,children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:s.name}),e.jsx(B,{variant:s.status==="pending"?"warning":s.status==="approved"?"success":"danger",children:s.status.toUpperCase()})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm text-gray-600",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Location:"})," ",s.address]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"License:"})," ",s.licenseNumber||"-"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Submitted:"})," ",s.createdAt?.toDate?s.createdAt.toDate().toLocaleString():"-"]})]}),e.jsxs("div",{className:"mt-2 text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Contact:"})," ",s.contactEmail]})]}),e.jsxs("div",{className:"flex space-x-2 ml-4",children:[s.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsxs(g,{size:"sm",variant:"outline",onClick:()=>w(s.id,"reject"),children:[e.jsx("i",{className:"ri-close-line mr-2"}),"Reject"]}),e.jsxs(g,{size:"sm",onClick:()=>w(s.id,"approve"),className:"bg-green-500 hover:bg-green-600 text-white",children:[e.jsx("i",{className:"ri-check-line mr-2"}),"Approve"]})]}),s.status==="approved"&&e.jsxs(g,{size:"sm",variant:"outline",onClick:()=>w(s.id,"reject"),children:[e.jsx("i",{className:"ri-close-line mr-2"}),"Reject"]}),s.status==="rejected"&&e.jsxs(g,{size:"sm",onClick:()=>w(s.id,"approve"),className:"bg-green-500 hover:bg-green-600 text-white",children:[e.jsx("i",{className:"ri-check-line mr-2"}),"Approve"]})]})]})},s.id))})()]})]})]}),y==="inventory"&&e.jsx("div",{className:"space-y-8",children:e.jsxs(x,{children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-6",children:"Global Blood Inventory"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:Z.map(t=>e.jsx(x,{className:"border-2 border-gray-100",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-pink-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("span",{className:"text-2xl font-bold text-pink-600",children:t.type})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:t.total}),e.jsx("p",{className:"text-sm text-gray-600",children:"Total Units"})]}),e.jsx("div",{className:`p-2 rounded-lg ${t.critical>20?"bg-red-50 text-red-700":t.critical>10?"bg-yellow-50 text-yellow-700":"bg-green-50 text-green-700"}`,children:e.jsxs("p",{className:"text-sm font-medium",children:[t.critical," Critical Stock"]})}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-pink-500 h-2 rounded-full",style:{width:`${t.percentage}%`}})}),e.jsxs("p",{className:"text-xs text-gray-500",children:[t.percentage,"% of total"]})]})]})},t.type))})]})}),y==="users"&&e.jsx("div",{className:"space-y-8",children:e.jsxs(x,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"Users"}),e.jsxs(B,{variant:"default",children:[I.length," Total"]})]}),O&&e.jsx("p",{className:"text-gray-600",children:"Loading users..."}),!O&&e.jsx("div",{className:"space-y-4",children:I.map(t=>e.jsx(x,{className:`border-l-4 ${t.userType==="donor"?"border-l-purple-500":t.userType==="superAdmin"?"border-l-pink-500":"border-l-blue-500"}`,children:e.jsxs("div",{className:"flex flex-wrap justify-between items-start gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-[200px]",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:t.name}),e.jsx("p",{className:"text-sm text-gray-600",children:t.email}),e.jsx("p",{className:"text-sm text-gray-600",children:t.phone||"No phone"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Joined:"," ",t.createdAt?.toDate?t.createdAt.toDate().toLocaleDateString():"-"]})]}),e.jsx(B,{variant:t.userType==="donor"?"success":t.userType==="superAdmin"?"default":"pink",children:t.userType.toUpperCase()}),t.userType!=="superAdmin"?e.jsx(g,{size:"sm",className:"bg-purple-500 hover:bg-purple-600 text-white",onClick:()=>se(t.id),children:"Make Super Admin"}):e.jsx(g,{size:"sm",className:"bg-red-500 hover:bg-red-600 text-white",onClick:()=>ae(t.id),children:"Remove Super Admin"})]})},t.id))})]})})]})}),e.jsx(he,{}),te&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 w-full max-w-md",children:[e.jsxs("h2",{className:"text-lg font-semibold mb-4 text-gray-900",children:["Confirm ",v==="approve"?"Approval":"Rejection"]}),e.jsxs("p",{className:"text-gray-600 mb-6",children:["Are you sure you want to ",v," this blood bank?"]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx(g,{onClick:()=>T(!1),className:"bg-gray-200 text-gray-800",children:"Cancel"}),e.jsx(g,{onClick:ne,className:v==="approve"?"bg-green-500 hover:bg-green-600 text-white":"bg-red-500 hover:bg-red-600 text-white",children:v==="approve"?"Approve":"Reject"})]})]})})]})}export{fe as default};
//# sourceMappingURL=page-oy4ispwz.js.map
